<html>
<head>
<h1>(DEV) Test Round Table</h1><br>
  <!-- load JQuery -->
  <script type="text/javascript" src="jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="jquery.ba-bbq.js"></script>
  <script type="text/javascript" src="jquery-url.js"></script>
  <!-- Fix $.ajax for IE8,9 -->
  <script type="text/javascript" src="jquery.xdomainrequest.js"></script>
  <!-- Assumes conf.js is in the same place as index.html -->
  <script src="conf.js"></script>
  <script src="app.js"></script>
  <script type="text/javascript">
    var label = $.url('?label');
    if (!label) {
      label = 'default';
    }
    // TODO(bbfsdev): extract interval function and execute it right away, so no delay
    // on first load.
    setInterval(function() { get_timestamp(function(time_now) { tables(label, function(data) {
      var tables_dict = data;
      var now_date = new Date($.now());
      var new_div = "<div>" + now_date.toString() + "</div>";
      $("#table_div").html(new_div);
      $("#table_div").append("<br>A \"Round Table\" will be removed from table below after " +
                          parseInt(conf.table_delete_timeout/60) + " minutes.<br><br>");
      var table_str = "";
      table_str +="<table border='1'><tr><td>label</td><td>id</td>" +
        "<td>Table is \"live\" if seconds<br>since update less then " + conf.table_stays_alive +
        "</td><td>link</td><td>Participants</td></tr>";
      for (var index in data.MGET) {
        if (data.MGET[index] != null) {
          var one_table = $.deparam(data.MGET[index]);
          table_str += "<tr><td>" + one_table.label + "</td>";
          table_str += "<td>" + one_table.id + "</td>";
          seconds_since_update = time_now - parseInt(one_table.timestamp);
          minutes_sice_update = seconds_since_update / 60;
          seconds_since_update = seconds_since_update % 60;
          table_str += "<td align=\"center\">" + parseInt(minutes_sice_update) + " min " +
                       parseInt(seconds_since_update) + " sec</td>";
          table_str += "<td><a target=\"_blank\" href=\"https://plus.google.com/hangouts/_/" +
            one_table.id + "?gid=" + conf.hangout_app_gid + "&gd=" + one_table.label + "\">join</a></td>";
          table_str += "<td>";
          for (var p_idx in one_table.participants) {
            table_str += one_table.participants[p_idx] + "<br>";
          }
          table_str += "</td></tr>";
        }
      }
      $("#table_div").append(table_str + "</table>");
    })})}, conf.button_update_interval); 

    $(function() {
      buttons_str = "<a href=\"//" + conf.host + "/user.html?label=" + label +
                    "\" target=\"_blank\">User Link (label=" + label + ")</a><br>" +
                    "<a href=\"//" + conf.host + "/admin.html?label=" + label +
                    "\" target=\"_blank\">Admin Link (label=" + label + ")</a><br>" +
                    "<a href=\"//" + conf.host + "/admin.html?onair=true&label=" + label +
                    "\" target=\"_blank\">Admin Link (OnAir) (label=" + label + ")</a>";
      $("#buttons").html(buttons_str);
    });
  </script>
</head>
<body>
<div id="buttons"></div>
<br>
<div id="table_div"></div>
</body>
</html>
